{"diagram":{"image":{"height":200,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","width":200,"y":0,"x":0},"elements":{"id":"root","structure":"mind_free","leftChildren":[{"id":"218a3ce3a74f","title":"hdfs","lineStyle":{"randomLineColor":"#0FBAB0"},"children":[{"id":"110098ef71e6","title":"架构","parent":"218a3ce3a74f","children":[{"id":"bf3d43bce00d","title":"NN","parent":"110098ef71e6","children":[{"id":"08efe1b230a5","title":"元数据管理","parent":"bf3d43bce00d","children":[{"id":"a434f4557bf6","title":"内存元数据","parent":"08efe1b230a5","children":[]},{"id":"8a1b05bd28a1","title":"fsimage","parent":"08efe1b230a5","children":[]},{"id":"0fdcb54ea2ca","title":"editlog","parent":"08efe1b230a5","children":[]}]},{"id":"81b6878712ff","title":"Client请求处理","parent":"bf3d43bce00d","children":[]}]},{"id":"0849c1a71d8b","title":"DN：存储/读写数据","parent":"110098ef71e6","children":[]},{"id":"804516c2177a","title":"SNN","parent":"110098ef71e6","children":[{"id":"c0ac8121015c","title":"冷备份，下载fsimage，editlog到本地并进行合并","children":[],"parent":"804516c2177a"}]},{"id":"374aeb934c70","title":"ZKFC","parent":"110098ef71e6","children":[{"id":"8986e90d800c","title":"监控NN状态，并写入状态信息到ZK","parent":"374aeb934c70","children":[]},{"id":"091d64019097","title":"强行杀死假死NN","parent":"374aeb934c70","children":[]}]},{"id":"81d11ee7f2fc","title":"JN","parent":"110098ef71e6","children":[{"id":"6df576271b4b","title":"存放editlog","parent":"81d11ee7f2fc","children":[]}]}]},{"id":"e5f6f8b390d1","title":"读/写流程","parent":"218a3ce3a74f","children":[{"id":"e3453de380a5","title":"读流程","parent":"e5f6f8b390d1","children":[{"id":"22dc305fdb9b","title":"1.Client请求","parent":"e3453de380a5","children":[]},{"id":"d380986211b5","title":"2.NN元数据校验","parent":"e3453de380a5","children":[]},{"id":"c92199ddd520","title":"3.NN返回目标文件元数据到Client","parent":"e3453de380a5","children":[]},{"id":"2e20b27a8195","title":"4.Client就近与DN建立Socket流，以packet为单位传输数据","parent":"e3453de380a5","children":[]},{"id":"7f2a64e68f15","title":"5.Client采用追加写的方式到文件","parent":"e3453de380a5","children":[]}]},{"id":"44d897b558e5","title":"写流程","parent":"e5f6f8b390d1","children":[{"id":"5be24230bf5c","title":"1.Client请求是否可以上传","parent":"44d897b558e5","children":[]},{"id":"f674c23a81b7","title":"2.NN检查目标文件/父目录是否已存在、用户权限","parent":"44d897b558e5","children":[]},{"id":"81f74d39cbd6","title":"3.Client请求上传1个block","parent":"44d897b558e5","children":[]},{"id":"b64b9a4c1cc5","title":"4.NN返回DN列表到Client","parent":"44d897b558e5","children":[]},{"id":"9c4ddc7a6284","title":"5.Client与DN建立pipeline，逐级通知","parent":"44d897b558e5","children":[]},{"id":"71bf6bdf2c63","title":"6.Client上传block，以packet为单位传输数据","parent":"44d897b558e5","children":[]}]}]},{"id":"942f4c8f6818","title":"宕机","parent":"218a3ce3a74f","children":[{"id":"5caacb6a9028","title":"NN宕机","children":[{"id":"4543743069ad","title":"重启","children":[],"parent":"5caacb6a9028"},{"id":"d72a9faccb7e","title":"提前搭建HA","children":[],"parent":"5caacb6a9028"}],"parent":"942f4c8f6818"},{"id":"85044a90a260","title":"DN宕机","children":[{"id":"849698d34187","title":"短期宕机","children":[{"id":"4c438b5b6999","title":"重启","children":[],"parent":"849698d34187"}],"parent":"85044a90a260"},{"id":"f979fee674c1","title":"长期宕机（数据已备份到其他DN）","children":[{"id":"1b193b0d1e08","title":"删除该DN数据，重启","children":[],"parent":"f979fee674c1"}],"parent":"85044a90a260"}],"parent":"942f4c8f6818"}]},{"id":"4645203899c2","title":"数据安全保障","children":[{"id":"12569e2fb466","title":"机架感知","parent":"4645203899c2","children":[]},{"id":"1e23eae51f42","title":"心跳机制","parent":"4645203899c2","children":[]},{"id":"4c60122719ee","title":"SNN","parent":"4645203899c2","children":[]},{"id":"bf7175d51d22","title":"安全模式","parent":"4645203899c2","children":[]}],"parent":"218a3ce3a74f"}],"parent":"root"}],"title":"hadoop","watermark":"","root":true,"theme":"delicate_caihong","children":[{"id":"4ae1a74e2409","title":"mapreduce","lineStyle":{"randomLineColor":"#0D7C82"},"children":[{"id":"4f90468dfd3b","title":"执行流程","children":[{"id":"efebe8ff4958","title":"1.启动MRAppMaster，计算MapTask（简称MT）数量","parent":"4f90468dfd3b","children":[]},{"id":"dc12f035a349","title":"2.MT读取文件，处理，写入MT缓存","children":[],"parent":"4f90468dfd3b"},{"id":"16730c48a214","title":"3.MT缓存溢写小文件（快排），合并（归并排序）","parent":"4f90468dfd3b","children":[]},{"id":"5fc9bede67c1","title":"4.RT拉取分区数据到RT缓存，RT缓存不够则溢写","parent":"4f90468dfd3b","children":[]},{"id":"3a6ffafa8adf","title":"5.合并（归并排序）","parent":"4f90468dfd3b","children":[]},{"id":"0c4d8e81eedc","title":"6.执行RT，写入磁盘","parent":"4f90468dfd3b","children":[]}],"parent":"4ae1a74e2409"},{"id":"b0dbd72f6942","title":"优化","parent":"4ae1a74e2409","children":[{"id":"88ce069c4205","title":"输入","children":[{"id":"3e5ada71a056","title":"小文件合并","children":[],"parent":"88ce069c4205"},{"id":"a09005ed9fff","title":"sequencefile","parent":"88ce069c4205","children":[]}],"parent":"b0dbd72f6942"},{"id":"b5dd2d41f3e4","title":"map","children":[{"id":"8da93cd65624","title":"减少溢写次数","children":[{"id":"030f46ed0ddb","title":"增大MT缓存","children":[],"parent":"8da93cd65624"},{"id":"6d427ede147f","title":"增大溢写触发百分比","children":[],"parent":"8da93cd65624"}],"parent":"b5dd2d41f3e4"},{"id":"44176b5819ac","title":"减少合并次数","children":[{"id":"b13d60acf154","title":"增大每次合并的文件数","children":[],"parent":"44176b5819ac"}],"parent":"b5dd2d41f3e4"},{"id":"ca29bec4190b","title":"combiner","children":[],"parent":"b5dd2d41f3e4"},{"id":"c28702b460b4","title":"mapjoin","children":[],"parent":"b5dd2d41f3e4"}],"parent":"b0dbd72f6942"},{"id":"ea7b07dfd5cc","title":"reduce","children":[{"id":"24949ba3c1cc","title":"合理设置MT（切片数决定）/RT数量","children":[],"parent":"ea7b07dfd5cc"},{"id":"9935c4ead70a","title":"设置MT/RT共存","children":[],"parent":"ea7b07dfd5cc"}],"parent":"b0dbd72f6942"},{"id":"a7f290380413","title":"压缩","parent":"b0dbd72f6942","children":[{"id":"c2e10890ed87","title":"snappy","parent":"a7f290380413","children":[]},{"id":"39aba0ce0514","title":"lzo","parent":"a7f290380413","children":[]}]},{"id":"e222356ab1ed","title":"统计方法","parent":"b0dbd72f6942","children":[{"id":"48f728c05535","title":"抽样范围分区","parent":"e222356ab1ed","children":[]}]}]}],"parent":"root"},{"id":"1c7fb53b92a4","title":"yarn","lineStyle":{"randomLineColor":"#FCB52A"},"children":[{"id":"b153e7fe63f8","title":"调度流程","children":[{"id":"3156927fea7a","title":"1.用户提交任务","children":[],"parent":"b153e7fe63f8"},{"id":"7e4a3d7aadf1","title":"2.RM为该任务在对应的NM上分配Container，在Container中启动ApplicationMaster","children":[],"parent":"b153e7fe63f8"},{"id":"75541cfa7c9e","title":"3.AM向RM注册，轮询申请资源，监控任务","children":[],"parent":"b153e7fe63f8"},{"id":"4b48cf2e37a0","title":"4.AM与NM通信，启动任务","children":[],"parent":"b153e7fe63f8"},{"id":"aae660c2bfba","title":"5.各任务通过RPC向AM汇报执行信息","children":[],"parent":"b153e7fe63f8"},{"id":"02914730cbea","title":"6.任务结束，AM注销","children":[],"parent":"b153e7fe63f8"}],"parent":"1c7fb53b92a4"},{"id":"118e5b290ab2","title":"调度策略","parent":"1c7fb53b92a4","children":[{"id":"464b4cef8111","title":"队列","parent":"118e5b290ab2","children":[]},{"id":"c6ee0f51eddb","title":"小任务","parent":"118e5b290ab2","children":[]},{"id":"8677e931742d","title":"公平","parent":"118e5b290ab2","children":[]}]}],"parent":"root"}],"note":""}},"meta":{"id":"60dbcdbae401fd7e3423c2dd","member":"5ff295855653bb21c1b7d3b9","exportTime":"2021-07-03 09:50:43","diagramInfo":{"category":"mind_free","title":"hadoop","created":"2021-06-30 09:49:46","creator":"5ff295855653bb21c1b7d3b9","modified":"2021-07-02 10:24:51"},"type":"ProcessOn Schema File","version":"1.0"}}