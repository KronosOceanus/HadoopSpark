{"diagram":{"image":{"height":200,"pngdata":"iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVR4nO3BAQEAAACCIP+vbkhAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8GXHmAAFMgHIEAAAAAElFTkSuQmCC","width":200,"y":0,"x":0},"elements":{"id":"root","watermark":"","title":"hbase","leftChildren":[{"id":"fc9e74a05cea","title":"架构","lineStyle":{"randomLineColor":"#02ACF4"},"children":[{"id":"31579e88d6f2","title":"hmaster","parent":"fc9e74a05cea","children":[{"id":"52e7d718045c","title":"管理用户对表（不包括内容）的增删查改","parent":"31579e88d6f2","children":[]},{"id":"8f97c1dffe4d","title":"存储region与regionserver对应关系<br>","parent":"31579e88d6f2","children":[]},{"id":"dbaf6573eab4","title":"region split之后负责新region的分配","parent":"31579e88d6f2","children":[]},{"id":"126f2e3b7c50","title":"region负载均衡","parent":"31579e88d6f2","children":[]}]},{"id":"98b822708405","title":"hregionserver<br>","children":[{"id":"766bb17b2ef7","title":"响应用户io请求","parent":"98b822708405","children":[]},{"id":"02654c93df30","title":"向hdfs读写数据","parent":"98b822708405","children":[]}],"parent":"fc9e74a05cea"},{"id":"a9accc3b0f7b","title":"物理模型","parent":"fc9e74a05cea","children":[{"id":"8c9db773ada1","title":"hmaster管理hregionserver","children":[],"parent":"a9accc3b0f7b"},{"id":"362b01b0958a","title":"表按照行切分为region<br>","children":[],"parent":"a9accc3b0f7b"},{"id":"1b5e057f6b11","title":"region包含一个hlog","children":[],"parent":"a9accc3b0f7b"},{"id":"db24833d423b","title":"region按列族切分为store","children":[],"parent":"a9accc3b0f7b"},{"id":"246bf010a4e1","title":"store包含memstore和storefile","children":[],"parent":"a9accc3b0f7b"},{"id":"17f67c847996","title":"storefile底层是写入hdfs的hfile","children":[],"parent":"a9accc3b0f7b"}]}],"parent":"root"},{"id":"8ac5fb4410c0","title":"流程","lineStyle":{"randomLineColor":"#80BA4C"},"parent":"root","children":[{"id":"5796ce2f70af","title":"读/写流程","parent":"8ac5fb4410c0","children":[{"id":"3c65e930775b","title":"读流程","children":[{"id":"85454d9b0e21","title":"1.Client连接zk","children":[],"parent":"3c65e930775b"},{"id":"455a74636d37","title":"2.从/hbase节点找到hbase:meta所在的regionserver（host:port）","children":[],"parent":"3c65e930775b"},{"id":"b02d549eedf2","title":"3.hbase:meta所在的regionserver根据namespace，表名和rowkey得到数据所属regionserver","children":[],"parent":"3c65e930775b"},{"id":"55d7aea8d3fb","title":"4regionserver返回对应的region数据到Client","children":[],"parent":"3c65e930775b"},{"id":"00793c3bc771","title":"注意：先后分别从内存（memestore），块缓存（blockcache），hdfs（storefile）中读取","children":[],"parent":"3c65e930775b"}],"parent":"5796ce2f70af"},{"id":"d90fcfcd1a38","title":"写流程","children":[{"id":"75a88681cc12","title":"1.Client连接zk","children":[],"parent":"d90fcfcd1a38"},{"id":"00b46fb760c1","title":"2.从/hbase节点找到hbase:meta所在的regionserver（host:port）","children":[],"parent":"d90fcfcd1a38"},{"id":"bb31bb11874d","title":"3.扫描hbase:meta表对应的rowkey范围所在的regionserver","children":[],"parent":"d90fcfcd1a38"},{"id":"be7bf1a39237","title":"4.Client请求对应regionserver，写入数据","children":[],"parent":"d90fcfcd1a38"}],"parent":"5796ce2f70af"}]},{"id":"213b4fa9903a","title":"flush流程","parent":"8ac5fb4410c0","children":[{"id":"4978f2304067","title":"1.memstore数据达到阈值（128M），将数据flush到硬盘，删除内存数据，删除hlog历史数据<br>","parent":"213b4fa9903a","children":[]},{"id":"a8ee2aa8c8d9","title":"2.数据存储在hdfs<br>","children":[],"parent":"213b4fa9903a"},{"id":"e41f0926c7db","title":"在hlog中做标记<br>","parent":"213b4fa9903a","children":[]}]},{"id":"7fb62afad387","title":"数据合并流程","children":[{"id":"f5475c7d84a4","title":"1.数据达到4块，hmaster将数据加载到本地进行合并<br>","children":[],"parent":"7fb62afad387"},{"id":"fc888186ed40","title":"2.合并数据超过256M，拆分为多个region并交给不同的regionserver管理<br>","children":[],"parent":"7fb62afad387"},{"id":"70ce2dc9d229","title":"3.当hregionser宕机后，将hregionserver上的hlog拆分，然后分配给不同的hregionserver加载<br>","children":[],"parent":"7fb62afad387"},{"id":"7c53a02a4bf3","title":"注意：hlog会同步到hdfs","parent":"7fb62afad387","children":[]}],"parent":"8ac5fb4410c0"}]},{"id":"06a72a8b8006","title":"优化","lineStyle":{"randomLineColor":"#FD5155"},"children":[{"id":"a51459c81699","title":"预分区","children":[{"id":"a23ef511a918","title":"手动","children":[],"parent":"a51459c81699"},{"id":"cd5d8d2c7840","title":"16进制序列","children":[],"parent":"a51459c81699"}],"parent":"06a72a8b8006"},{"id":"8054bf6d6fad","title":"rowkey优化","children":[{"id":"43d21f3f09f3","title":"长度","children":[{"id":"fe9f3d3895ec","title":"最大长度64kb，建议8位对齐，越短越好","parent":"43d21f3f09f3","children":[]}],"parent":"8054bf6d6fad"},{"id":"180dfb10b14f","title":"散列","parent":"8054bf6d6fad","children":[{"id":"57bdb2b5a4ac","title":"加盐","parent":"180dfb10b14f","children":[]},{"id":"33a3b0cd23d8","title":"hash","parent":"180dfb10b14f","children":[]},{"id":"89d0aa62ff32","title":"反转","parent":"180dfb10b14f","children":[]}]}],"parent":"06a72a8b8006"},{"id":"caf4eb500318","title":"内存","parent":"06a72a8b8006","children":[{"id":"32ecb6c76b52","title":"表可以缓存在内存中，可以分配更多内存","parent":"caf4eb500318","children":[]}]},{"id":"545d59aa52ff","title":"列族压缩","children":[],"parent":"06a72a8b8006"},{"id":"6c05cde7cdb4","title":"开启布隆过滤器","parent":"06a72a8b8006","children":[]}],"parent":"root"}],"structure":"mind_free","root":true,"theme":"delicate_caihong","children":[{"id":"ce0f0d92472f","title":"其他","lineStyle":{"randomLineColor":"#FA5465"},"parent":"root","children":[{"id":"7ab31ed5885b","title":"hive跟hbase的区别是？","children":[],"parent":"ce0f0d92472f"},{"id":"8618886b9d18","title":"使用Hbase做即席查询，如何设计二级索引？","parent":"ce0f0d92472f","children":[]},{"id":"9a642538eff2","title":"hbase的优缺点？","children":[{"id":"491b1e4faa46","title":"优点","children":[{"id":"57881779aefc","title":"列动态增加，为空则不存储，节约空间","children":[],"parent":"491b1e4faa46"},{"id":"4e368d85e483","title":"自动切分，合并","children":[],"parent":"491b1e4faa46"},{"id":"a3b0f55b25f8","title":"支持高并发读写（主要是因为内存缓存）","parent":"491b1e4faa46","children":[]}],"parent":"9a642538eff2"},{"id":"5568226b65aa","title":"缺点","children":[{"id":"5a7cfa8aad24","title":"不支持条件查询","parent":"5568226b65aa","children":[]}],"parent":"9a642538eff2"}],"parent":"ce0f0d92472f"},{"id":"48d2631e4605","title":"hbase与传统数据库的区别？","parent":"ce0f0d92472f","children":[{"id":"e2dd4764884f","title":"hbase","parent":"48d2631e4605","children":[{"id":"9ed732cc9cb5","title":"数据类型：字符串","parent":"e2dd4764884f","children":[]},{"id":"c40450cc2499","title":"简单的增删查改，表与表之间分离","parent":"e2dd4764884f","children":[]},{"id":"614d1b437771","title":"列式存储，列族文件分离，降低系统io，实现并发处理","parent":"e2dd4764884f","children":[]},{"id":"161abf16330a","title":"更新是插入新的数据","parent":"e2dd4764884f","children":[]},{"id":"e4563e78d844","title":"单行事务","parent":"e2dd4764884f","children":[]}]},{"id":"9dbddb4e5125","title":"传统数据库","parent":"48d2631e4605","children":[{"id":"7448276c90c2","title":"数据类型复杂","parent":"9dbddb4e5125","children":[]},{"id":"901478f82804","title":"有各种函数，表与表之间关系复杂","parent":"9dbddb4e5125","children":[]},{"id":"4cce03bad821","title":"表格结构，行存储，如果没有索引将消耗大量io，建立索引也需要大量时间和资源","parent":"9dbddb4e5125","children":[]},{"id":"c4b209d74694","title":"更新是数据替换和修改","parent":"9dbddb4e5125","children":[]},{"id":"c8716fb23425","title":"可多行事务","parent":"9dbddb4e5125","children":[]}]}]}]}],"note":""}},"meta":{"id":"60dd2a790e3e745b089f2b5d","member":"5ff295855653bb21c1b7d3b9","exportTime":"2021-07-03 09:50:56","diagramInfo":{"category":"mind_free","title":"hbase","created":"2021-07-01 10:37:45","creator":"5ff295855653bb21c1b7d3b9","modified":"2021-07-02 17:10:41"},"type":"ProcessOn Schema File","version":"1.0"}}